<div class="exam-admin-container">
  <h2 class="admin-title">Manage Exam Questions</h2>

  <!-- Step 1: Select Exam -->
  <div class="form-group">
    <label for="examSelect">Select Exam</label>
    <select id="examSelect" [(ngModel)]="selectedExamId" (change)="selectExam(selectedExamId!)" name="examSelect">
      <option [ngValue]="null">-- Choose Exam --</option>
      <option *ngFor="let exam of exams" [ngValue]="exam.id">{{ exam.title }}</option>
    </select>
  </div>

  <!-- Step 2: Show questions for selected exam -->
  <div *ngIf="selectedExam">
    <h3>Questions in {{ selectedExam.title }}</h3>
    <div class="questions-list">
      <div *ngFor="let q of selectedExam.questions" class="question-card" [class.selected]="q.id === selectedQuestionId" (click)="selectQuestion(q.id)">
        <div class="q-header">
          <span class="q-number">Q{{ q.id }}.</span>
          <span class="q-text">{{ q.text }}</span>
        </div>
        <ul class="q-options">
          <li *ngFor="let opt of q.options" [class.correct]="opt === q.correct">{{ opt }}</li>
        </ul>
      </div>
    </div>
    <div class="question-actions">
      <button (click)="chooseAction('add')" class="action-btn">Add Question</button>
      <button (click)="chooseAction('edit')" [disabled]="!selectedQuestion" class="action-btn">Edit Selected</button>
      <button (click)="chooseAction('delete')" [disabled]="!selectedQuestion" class="action-btn delete">Delete Selected</button>
    </div>
  </div>

  <!-- Add/Edit Modal Popup -->
  <div class="modal-backdrop" *ngIf="action === 'add' || action === 'edit'">
    <div class="modal-form">
      <form (ngSubmit)="action === 'add' ? addQuestion() : updateQuestion()" class="question-form">
        <h4>{{ action === 'add' ? 'Add New Question' : 'Edit Question' }}</h4>
        <div class="form-group">
          <label>Question Text</label>
          <input type="text" [(ngModel)]="questionForm.text" name="questionText" required placeholder="Enter question..." />
        </div>
        <div class="form-group">
          <label>Options</label>
          <div class="options-list">
            <div *ngFor="let opt of questionForm.options; let i = index" class="option-item">
              <span>{{ opt }}</span>
              <button type="button" (click)="removeOption(i)" class="remove-option">&times;</button>
            </div>
          </div>
          <div class="add-option-row">
            <input type="text" [(ngModel)]="optionInput" name="optionInput" placeholder="Add option..." (keyup.enter)="addOption()" />
            <button type="button" (click)="addOption()" class="add-option-btn">Add</button>
          </div>
        </div>
        <div class="form-group">
          <label>Correct Answer</label>
          <select [(ngModel)]="questionForm.correct" name="correctAnswer" required>
            <option *ngFor="let opt of questionForm.options" [value]="opt">{{ opt }}</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="submit" class="save-btn">{{ action === 'add' ? 'Add Question' : 'Update Question' }}</button>
          <button type="button" (click)="cancelAction()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal Popup -->
  <div class="modal-backdrop" *ngIf="action === 'delete' && selectedQuestion">
    <div class="modal-form delete-modal">
      <h4>Delete Question</h4>
      <p>Are you sure you want to delete this question?</p>
      <div class="q-text">{{ selectedQuestion.text }}</div>
      <div class="form-actions">
        <button (click)="deleteQuestion()" class="delete-btn">Delete</button>
        <button (click)="cancelAction()" class="cancel-btn">Cancel</button>
      </div>
    </div>
  </div>
</div>
